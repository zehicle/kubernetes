#
# Ansible Playbook Role
#

---
# This defines where to get the playbook to cache
# https, http defines a git repo location
# otherwise path to playbook (relative to this directory)
playbook_src_path: https://github.com/rackn/kubernetes-contrib.git

# Directory in src containing the playbook
playbook_path: ansible

# The playbook file
playbook_file: cluster.yml

# Map rebar roles to ansible roles
# This is only used for dynamic playbooks.
role_role_map:

# Map rebar roles to ansible groups
role_group_map:
  kubernetes-etcd:
    - etcd
  kubernetes-master-install:
    - masters
  kubernetes-master-config:
    - masters
  kubernetes-node-install:
    - nodes
  kubernetes-node-config:
    - nodes
  kubernetes-gateway-install:
    - nodes
  kubernetes-gateway-config:
    - nodes

# Map rebar roles to ansible tags
role_tag_map:
  kubernetes-etcd:
    - pre-ansible
    - etcd
  kubernetes-master-install:
    - pre-ansible
    - binary-update
  kubernetes-master-config:
    - pre-ansible
    - masters
  kubernetes-node-install:
    - pre-ansible
    - binary-update
  kubernetes-node-install:
    - pre-ansible
    - nodes
  kubernetes-gateway-install:
    - pre-ansible
    - binary-update
  kubernetes-gateway-install:
    - pre-ansible
    - nodes
  kubernetes-network-service-install:
    - pre-ansible
    - network-service-install
  kubernetes-network-service-config:
    - pre-ansible
    - network-service-config
  kubernetes-docker:
    - pre-ansible
    - docker
  kubernetes-addons:
    - pre-ansible
    - addons
  kubernetes-node:
    - pre-ansible
    - nodes

attribute_map:
  - path: http_proxy
    name: rebar/proxy/servers[0]/url
  - path: https_proxy
    name: rebar/proxy/servers[0]/url
  - path: etcd_name
    name: etcd/name
  - path: etcd_address
    name: etcd/address

# Not sure why this is needed!  The one below should set it, but it doesn't
#  - path: opencontrail_build_http_proxy
#    name: rebar/proxy/servers[0]/url
#  - path: opencontrail_http_proxy
#    name: rebar/proxy/servers[0]/url
#  - path: opencontrail_ipaddr
#    name: eval:ipaddress(v4_only, contrail-network-category).cidr
#  - path: opencontrail_interface
#    name: eval:ipaddress(v4_only, contrail-network-category).ifname
#  - path: opencontrail_masters_ipaddr
#    name: eval:nodes_with_role(contrail-master).ipaddress(v4_only, kubernetes-network-category).address
#  - path: opencontrail_first_masters_ipaddr
#    name: eval:first_node_with_role(contrail-master).ipaddress(v4_only, kubernetes-network-category).address

